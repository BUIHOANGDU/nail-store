<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nail & Nail Shop</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&family=Dancing+Script&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #fff0f5;
      font-family: 'Quicksand', sans-serif;
      margin: 0;
    }
    header {
      background-color: #ffe0ec;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    h1 {
      font-family: 'Dancing Script', cursive;
      font-size: 2.5em;
      color: #e91e63;
      margin: 0;
    }
    .cart-btn {
      position: absolute;
      right: 20px;
      top: 20px;
      background-color: #f472b6;
      color: white;
      border: none;
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 1rem;
      cursor: pointer;
    }
    .cart-btn:hover {
      background-color: #ec4899;
    }
    .filter-bar {
      text-align: center;
      margin: 20px;
    }
    .filter-bar select {
      padding: 10px;
      font-size: 1rem;
      border-radius: 12px;
      border: 1px solid #f9a8d4;
      background-color: #fff;
    }
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
      padding: 30px;
      max-width: 1000px;
      margin: auto;
    }
    .product-card {
      background: white;
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      text-align: center;
      transition: transform 0.2s;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 360px;
    }
    .product-card:hover {
      transform: scale(1.03);
    }
    .product-card img {
      width: 100%;
      max-height: 160px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
    }
    .product-info {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .product-name {
      margin-top: 10px;
      font-weight: 600;
      font-size: 1rem;
      color: #d63384;
    }
    .product-price {
      color: #777;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }
    .add-to-cart {
      background-color: #f472b6;
      color: white;
      padding: 8px 12px;
      border: none;
      border-radius: 10px;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .add-to-cart:hover {
      background-color: #ec4899;
    }
    footer {
      background-color: #ffe0ec;
      text-align: center;
      padding: 20px;
      font-size: 0.9rem;
      margin-top: 40px;
    }
    .popup-overlay, .cart-popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .popup-content {
      background: white;
      padding: 20px;
      border-radius: 16px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .popup-content img {
      width: 100%;
      max-height: 250px;
      object-fit: cover;
      border-radius: 12px;
    }
    .popup-close {
      margin-top: 15px;
      background-color: #e91e63;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-size: 1rem;
      cursor: pointer;
    }
    .popup-close:hover {
      background-color: #c2185b;
    }
  </style>
</head>
<body>
  <header>
    <h1>Nail & Nail Shop</h1>
    <button class="cart-btn" onclick="showCart()">üõí Gi·ªè (<span id="cart-count">0</span>)</button>
  </header>

  <div class="filter-bar">
    <label for="filter">L·ªçc theo lo·∫°i: </label>
    <select id="filter" onchange="renderFilteredProducts()">
      <option value="all">T·∫•t c·∫£</option>
      <option value="nail">Nail</option>
      <option value="phu-kien">Ph·ª• ki·ªán</option>
      <option value="gel">Gel</option>
    </select>
  </div>

  <div class="product-grid" id="product-list"></div>

  <footer>
    <p>&copy; 2025 Nail Caf√©. All rights reserved.</p>
  </footer>

  <!-- Popup chi ti·∫øt s·∫£n ph·∫©m -->
  <div class="popup-overlay" id="popup">
    <div class="popup-content">
      <img id="popup-img" src="" alt="·∫¢nh s·∫£n ph·∫©m">
      <h3 id="popup-name"></h3>
      <p id="popup-price"></p>
      <button class="popup-close" onclick="closePopup()">ƒê√≥ng</button>
    </div>
  </div>

  <!-- Popup gi·ªè h√†ng -->
  <div class="cart-popup popup-overlay" id="cart-popup">
    <div class="popup-content">
      <h3>üõí Gi·ªè h√†ng c·ªßa b·∫°n</h3>
      <div id="cart-items" style="text-align:left; max-height: 250px; overflow:auto;"></div>
      <p><strong>T·ªïng ti·ªÅn:</strong> <span id="cart-total">0</span></p>
      <button onclick="submitOrder()">X√°c nh·∫≠n ƒë∆°n</button>
      <button onclick="clearCart()">X√≥a t·∫•t c·∫£</button>
      <button class="popup-close" onclick="closeCartPopup()">ƒê√≥ng</button>
    </div>
  </div>

  <!-- Firebase SDK -->
  <!-- Gi·ªØ nguy√™n to√†n b·ªô ph·∫ßn <head> v√† style c·ªßa b·∫°n -->

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC2OVhgdTn15eTSmKhZxw3lkC3Wqz0TmRg",
    authDomain: "nail-fcd76.firebaseapp.com",
    projectId: "nail-fcd76",
    storageBucket: "nail-fcd76.appspot.com",
    messagingSenderId: "292496013690",
    appId: "1:292496013690:web:09dd92cd65115c497e3ec3"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let allProducts = [];

  function loadProducts() {
    db.collection("products").get().then(snapshot => {
      const typePriority = { "nail": 0, "gel": 1, "phu-kien": 2 };
      allProducts = snapshot.docs.map(doc => {
        const data = doc.data();
        data.createdAt = data.createdAt?.toDate ? data.createdAt.toDate() : new Date(); // fallback
        return data;
      });

      // S·∫Øp x·∫øp theo lo·∫°i ∆∞u ti√™n v√† m·ªõi nh·∫•t
      allProducts.sort((a, b) => {
        const typeDiff = typePriority[a.type] - typePriority[b.type];
        if (typeDiff !== 0) return typeDiff;
        return b.createdAt - a.createdAt;
      });

      renderFilteredProducts();
    });
  }

  function renderFilteredProducts() {
    const filter = document.getElementById("filter").value;
    const container = document.getElementById("product-list");
    container.innerHTML = "";
    const filtered = filter === "all" ? allProducts : allProducts.filter(p => p.type === filter);

    filtered.forEach(data => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <img src="${data.imageUrl}" alt="${data.name}" onclick="showPopup('${data.name}', '${data.imageUrl}', '${data.price}')">
        <div class="product-info">
          <div class="product-name">${data.name}</div>
          <div class="product-price">${Number(data.price).toLocaleString("vi-VN")}VND</div>
        </div>
        <button class="add-to-cart" onclick="addToCart('${data.name}', '${data.imageUrl}', '${data.price}')">Th√™m v√†o gi·ªè</button>
      `;
      container.appendChild(card);
    });
  }

  function showPopup(name, img, price) {
    document.getElementById("popup-name").innerText = name;
    document.getElementById("popup-img").src = img;
    document.getElementById("popup-price").innerText = `${Number(price).toLocaleString("vi-VN")} VND`;
    document.getElementById("popup").style.display = "flex";
  }

  function closePopup() {
    document.getElementById("popup").style.display = "none";
  }

  function addToCart(name, imageUrl, priceText) {
    const price = parseInt(priceText.replace(/[^\d]/g, ""));
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const existing = cart.find(p => p.name === name);
    if (existing) {
      existing.quantity += 1;
    } else {
      cart.push({ name, imageUrl, price, quantity: 1 });
    }
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
    alert(`ƒê√£ th√™m ${name} v√†o gi·ªè h√†ng!`);
  }

  function updateCartCount() {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    document.getElementById("cart-count").innerText = cart.reduce((sum, p) => sum + p.quantity, 0);
  }

  function showCart() {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    const list = document.getElementById("cart-items");
    const total = document.getElementById("cart-total");
    let sum = 0;
    list.innerHTML = "";

    if (cart.length === 0) {
      list.innerHTML = "<p>Gi·ªè h√†ng ƒëang tr·ªëng.</p>";
    } else {
      cart.forEach((item, index) => {
        const row = document.createElement("div");
        row.innerHTML = `
          <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
            <img src="${item.imageUrl}" style="width:60px; height:60px; border-radius:8px; object-fit:cover;" />
            <div style="flex:1;">
              <strong>${item.name}</strong><br>
              SL: ${item.quantity} x ${item.price.toLocaleString("vi-VN")}<br>
              <strong>${(item.price * item.quantity).toLocaleString("vi-VN")}</strong>
            </div>
            <button onclick="removeItem(${index})">‚ùå</button>
          </div>
        `;
        list.appendChild(row);
        sum += item.price * item.quantity;
      });
    }

    total.innerText = sum.toLocaleString("vi-VN");
    document.getElementById("cart-popup").style.display = "flex";
  }

  function removeItem(index) {
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    cart.splice(index, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    showCart();
    updateCartCount();
  }

  function clearCart() {
    localStorage.removeItem("cart");
    showCart();
    updateCartCount();
  }

  function closeCartPopup() {
    document.getElementById("cart-popup").style.display = "none";
  }

  function submitOrder() {
    const cart = JSON.parse(localStorage.getItem("cart") || "[]");
    if (cart.length === 0) return alert("Gi·ªè h√†ng tr·ªëng!");

    const orderData = {
      items: cart,
      total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0),
      createdAt: new Date()
    };

    db.collection("orders").add(orderData).then(() => {
      alert("üßæ ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn m√°y in!");
      clearCart();
    }).catch((err) => {
      console.error("L·ªói g·ª≠i ƒë∆°n:", err);
      alert("L·ªói khi g·ª≠i ƒë∆°n h√†ng.");
    });
  }

  // G·ªçi h√†m sau khi DOM s·∫µn s√†ng
  window.onload = () => {
    updateCartCount();
    loadProducts();
  };
</script>

</body>
</html>
